<div class="container">
  <%= render :partial => "/modules/colorful/weixin_head" %>
</div>
<div class="message_div">
  <div class="message_title">
    <a href="<%= url_for(:action=>:index) %>" title="返回" class="weixin_return">返回</a>主题活动
    <%= link_to("删除",url_for(:controller=>"/weixin/activities",:action=>:destroy,:id=>@activity.id),:method=>:delete, :confirm => "您确定删除该活动吗?", :class => "new_message")%>
    <%= link_to "修改", edit_weixin_activity_path(@activity), :class => "new_message" %>
  </div>
  <div class="message_list">
    <ul class="data_list">
      <li class="show">
        <p class="title"><span class="name"><%= @activity.title %></span></p>
        <p class="info"><span class="time"><%= @activity.start_at.try(:to_short_datetime) %></span>&nbsp;~&nbsp;<span><%= @activity.end_at.try(:to_short_datetime) %></span></p>
        <p class="info">由&nbsp;<span class="author"><%= @activity.creater.try(:name) %></span>&nbsp;创建于&nbsp;<span><%= @activity.created_at.try(:to_long_datetime) %></span></p>
        <div class="ctivity_content_logo">
          <% if @activity.asset_img.blank? %>
            <img src="/t/colorful/activity_logo1.jpg" alt="" />
          <% else %>
            <a href="<%= @activity.asset_img.public_filename(:thumb) %>" class="fancybox" title="" >
              <img src="<%= @activity.asset_img.public_filename(:middle) %>" />
            </a>
          <% end %>
        </div>
        <div class="content">
          <%= simple_format @activity.note, :class => "note" %>
          <%= simple_format @activity.content %>
        </div>
      </li>
      <% unless @replies.blank? %>
        <li id="replies_count" class="replies_count">
          <p>共收到<%= @activity.activity_entries.any? ? @activity.activity_entries.count : 0 %>条回复</p>
        </li>
        <ul class="topic_replies">
          <% @replies.each do |reply| %>
            <li class="show" id="activity_entry_<%= reply.id %>">
              <p class="info">
              <span class="author"><%= reply.creater.try(:name) %></span>&nbsp;回复于&nbsp;<span><%= reply.created_at.to_long_datetime %></span>
              </p>
              <div class="content"><%= simple_format reply.note %></div>
            </li>
          <% end %>
        </ul>
        <%= paginate @replies %>
      <% else %>
        暂无回复
      <% end %>
      <li class="reply">
        <%= simple_form_for(@activity_entry, :validate => true, :url => weixin_activity_entries_path, :html => {:class => "form-horizontal"}) do |f| %>
          <div class="field">
            <label class="field_prompt">回复</label>
            <%= f.kindeditor :note, :class => 'profile_input required', :editor_id => 'topic_content',:allowFileManager => false,:allowUpload=>false, :allowFlashUpload => false, :simple_mode => true %>
            <br />
            <%= f.button :submit, :class => "btn" %>
          </div>
          <%= f.input :creater_id, :as => :hidden %>
          <%= f.input :activity_id, :as => :hidden %>
          <%= f.input :tp, :as => :hidden %>
        <% end %>
      </li>
    </ul>
    <br/>
  </div>
</div>
<%= render :partial => "/modules/colorful/weixin_menu_navbar"%>
<%= render :partial => "/modules/colorful/weixin_menu_one"%>
<script type="text/javascript">
$(":submit").click(function() {
  var flag = [];
  if (topic_content.html().length < 3 || topic_content.isEmpty()) {
    if ( $("#activity_entry_note").next("span.help-inline").length == 0 ) {
      $("<span class='help-inline'>长度不够(必须超过3个字符)</span>").insertAfter("#activity_entry_note")
    }
    flag.push(true)
  } else {
    if ( $("#activity_entry_note").next("span.help-inline").length > 0 ) {
      $("#activity_entry_note").next("span.help-inline").remove()
    }
    flag.push(false)
  }
  for( i in flag ) {
    if(flag[i] == true) {
      flag.length = 0;
      return false;
    }
  }
})
</script>
