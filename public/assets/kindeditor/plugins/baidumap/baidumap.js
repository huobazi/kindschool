/*******************************************************************************
* KindEditor - WYSIWYG HTML Editor for Internet
* Copyright (C) 2006-2011 kindsoft.net
*
* @author Roddy <luolonghao@gmail.com>
* @site http://www.kindsoft.net/
* @licence http://www.kindsoft.net/license.php
*******************************************************************************/
KindEditor.plugin("baidumap",function(e){var i=this,a="baidumap",t=i.lang(a+"."),n=e.undef(i.mapWidth,558),o=e.undef(i.mapHeight,360);i.clickToolbar(a,function(){function d(){l=g[0].contentWindow,c=e.iframeDoc(g)}var l,c,r=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',t.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+t.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+t.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+n+"px;height:"+o+'px;"></div>',"</div>"].join(""),s=i.createDialog({name:a,width:n+42,title:i.lang(a),body:r,yesBtn:{name:i.lang("yes"),click:function(){var e=l.map,a=e.getCenter(),t=a.lng+","+a.lat,d=e.getZoom(),c=[h[0].checked?i.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(t),"&zoom="+encodeURIComponent(d),"&width="+n,"&height="+o,"&markers="+encodeURIComponent(t),"&markerStyles="+encodeURIComponent("l,A")].join("");h[0].checked?i.insertHtml('<iframe src="'+c+'" frameborder="0" style="width:'+(n+2)+"px;height:"+(o+2)+'px;"></iframe>'):i.exec("insertimage",c),i.hideDialog().focus()}},beforeRemove:function(){u.remove(),c&&c.write(""),g.remove()}}),m=s.div,p=e('[name="address"]',m),u=e('[name="searchBtn"]',m),h=e('[name="insertDynamicMap"]',s.div),g=e('<iframe class="ke-textarea" frameborder="0" src="'+i.pluginsPath+'baidumap/map.html" style="width:'+n+"px;height:"+o+'px;"></iframe>');g.bind("load",function(){g.unbind("load"),e.IE?d():setTimeout(d,0)}),e(".ke-map",m).replaceWith(g),u.click(function(){l.search(p.val())})})});